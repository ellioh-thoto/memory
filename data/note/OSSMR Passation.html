<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>OSSMR Passation</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
</head>
<body>
  <h1>OSSMR Passation</h1>
  <div id="content">
    <p class="MsoNormal"></p><ul><li>Installation en QC et staging d’une release.&nbsp;</li><li>Architecture du projet</li><li>Architecture du code</li><li>Présentation des différents environnements et
leurs différence.</li><li>Mise en place de l’UAT 3 avec Jenkins</li><li>Présentation des CRON</li><li>API avec Sherlock</li><li>API avec Siebel</li><li>API avec SAP</li><li>API avec La poste ( EDI, DDT, SDD, PDD,….)</li><li>Présentation de Envoy multi carrier et d certaines
spécificité carrier</li><li>Présentation Administration (gestion des
emails, des pack codes, des images, etc….)</li><li>Tracking transporteur ( WS, FTP, fichiers des
events intégration, ….)</li><li>Présentation de la partie saisie facture.</li><li>Présentation de la partie Lettre</li><li>Fonctionnement de la balance</li><li>Tags google analytics</li><li>API avec Mesenvois</li></ul><div><br></div><div><br></div><div><br></div><div><ul><li>Mes envois</li><ul><li>Compare &gt; api &gt; getShipmentPriceDelayShopping (oss core function, modifié pour ossmr)_</li><ul><li>SGD : OSSMR&gt; design&gt;SGD &gt;WSER.v0.11</li><li>1 requete / Carrier</li><li>Screen cote mesEnvoy List de service</li><ul><li>select 1 service</li><ul><li>Redirection vers page authenfication &nbsp;oss</li><ul><li>Ticket</li><ul><li>authentification coté oss</li><li>le ticket en param prime dans oss</li></ul><li>sgd PAU.v0.2</li><li>url ...niss_auth</li><li>access step 3</li><li>data encodé ~base64 (service , shipment, url du caller for logout redirection)</li></ul></ul></ul><li>Bouton creer un compte</li><ul><li>Iframe</li><li>inscription.mesenvoi.fr&nbsp;</li><li>siebel dev aux iles maurice</li><li>hebergé a bagneux</li><li>Minscrire: &nbsp;</li><ul><li>functioon api creation de compte (createsloc)</li><li>redirection vers la sloc created (url ...niss_auth)</li><li>data de shipment passé en GET (au cas ou on vient du bouton compare)</li></ul></ul></ul><li>Environement de test : staging.mesenvoi.fr</li><li>Non versionné!!!!!</li></ul><li>Google analytics</li><ul><li>rajouter le point pour regler les pb de sous domaine &nbsp;".mesenvoi.fr"</li><li>marketing : track depuis google</li><li>+ block pour transmettre les données de tracking a une iframe (page d'inscription - iframe siebel) (</li><li>dans oss. donnee de tracking dans le head http</li><li>Pour tester modifier le code "UIXXXXXXX"</li></ul></ul></div><div><br></div><div><ul><li>Siebel:</li><ul><li>peut potentiellment creer des comptes sans passer par l'ecran de mes envoi</li><li>logs : data/temporary/logs/siebel.log</li><ul><li>log toute les requetes createsloc</li></ul></ul></ul></div><div><span>&nbsp;&nbsp; &nbsp;</span><br></div><div><br></div><div><ul><li>Service:</li><ul><li>Neopost &gt; Transporteur&nbsp;</li><ul><li>detail &gt; transporteur avec api</li><ul><li>envoy API</li><ul><li>prix HT TTc</li></ul></ul><li>Envoy</li><ul><li>LOGS: &nbsp;</li><ul><li>general : /home/apache/envoy/envoy-qc1 (qc) (..envoy/envoy -&gt; prod)</li><li>log transporteur : ../logs/envoy-logfile.txt</li><ul><li>Application : data/temporary/log/envoy.log</li></ul></ul><li>transporteur :</li><ul><li>Chronopost</li><ul><li>code service ( 0 code service par default voir spec pour detail) -- specific chrono</li><li>code produit (service) - Chronopost only &nbsp;</li></ul><li>UPS</li><li>DHL</li><li>Fedex</li></ul><li>No EDI</li></ul><li>Autres</li><ul><li>Coliposte (Colis only)</li><li>KNA (palette only)</li><li>La poste (lettre only)</li><li>Diff</li><ul><li>Tranche de num d'expé</li><ul><li>config service &gt; No d'expe et de colis</li></ul><li>Etiquette</li><ul><li>config service &gt; etiquette</li><li>Generé dans neopost &gt;modeles docs (DGEN)</li><ul><li>mode previous not up to date</li></ul><li><br></li></ul><li>Tarif</li><ul><li>association : Code service + code tarif</li></ul><li>Tracking</li><ul><ul><li>Avec Edi (balance , process, etiquette , edi, archivage) (ex coliposte)</li><ul><li>configurable niveau shipping location</li><li>/home/apache//common/ossmailroom/output/edi (oss/data/output/edi)</li><ul><li>label</li><ul><li>13 : neopost france</li><li>transposteur (COL)</li><li>service (8V)&nbsp;</li><li>~agence/compte&nbsp;</li></ul><li>Format EDI fact</li></ul><li>Edi envoyé au serveur trad express (langage de mapping... + envoi de mail entre autres)</li><li>Mapping de trad express to transporteur (ex: la poste attend un format DDT)</li><li>Format edi fact :&nbsp;</li><ul><li>1 fichier avec + shipment data</li><li>lecture ligne par ligne</li><li>1 / 2 chars de debut de ligne determine la fonction de la ligne&nbsp;</li><li>La lecture commence par une ligne de header (1) et se termine par un tailer (9)</li></ul></ul><li>tracking par url</li><ul><li>Niveau Transporteur ou niveau service</li><ul><li>DHL</li><li>UPS</li></ul></ul></ul><li>Autre config ??, + detail format mapping</li></ul></ul></ul></ul></ul></ul><br><ul><li>Sherlock &nbsp;</li><ul><li>plateforme de paiement - appartient LCL - CB only - 3D secure (bank account check)</li><li>Formlule</li><ul><li>Colis</li><li>Credit lettre</li><li>abonnement lettre</li></ul><li>mode :</li><ul><li>CB (Sherlock)</li><li>Compte neopost (prelement mensuel)</li></ul><li>Recap de paiement :&nbsp;</li><ul><li>Block généré par sherlock : "Paiement de la commande"</li><li>Puis redirection vers le site sherlock&nbsp;</li><ul><li>Staging : # 01429...</li><li>Prod : #### 0329...</li></ul></ul><li>Config :&nbsp;</li><ul><li>NFrance.ini &gt; sherlock</li><ul><li><br></li></ul></ul><li>Doc : OSS Mailroom &gt; 02 requiement &gt; sherlocks (dir fourni par sherlock)</li><ul><li>request.bin</li><ul><li>prend en parametre les param de NFrance.ini</li><ul><li>"caddie" : cusome data</li></ul><li>genere le block " Paiement de la commande"</li><li>when user click on card picture, the navigateur redirect to sherlock web page</li></ul><li>Guide d'instatllation :&nbsp;</li><ul><li>info de test CB de test</li></ul><li>response.bin</li><ul><li>As soon as the user valid the payment, an autoresponse request is sent to OSSMR server via direct url call (data sent as param)</li><li>After that sherlock redirect the user to OSSMR with the same data as param. the data sent via this call are used to double check the transaction closure</li><ul><li>if the transaction is not closed safely OSS close the transaction</li></ul><li>/!\ the binary response.bin is used to Manage la response et l'auto response</li><li>Transaction ID returné permet de retrouver les donnée de shipment</li></ul><li>Status de commande &nbsp;: mes achats</li></ul><li>Abandon</li><ul><li>Annulation &gt; gere un status abandon de commande ( un cron pass du status "en cours" &nbsp;pastille jaune a "abandon" bleu</li></ul></ul><li>CRON</li><ul><li>Check crontab -e &nbsp;en qc for more detail</li><li>nissom&nbsp;</li><ul><li>RPT (user niss)</li><li>TTR purge</li><li>WS2DCS&nbsp;</li><ul><li>UPS DHL</li></ul><li>ASM</li></ul><li>oss</li><ul><li>Lettre - tous les jours a 00h01</li><ul><li>Lettres non expedié (panier des lettres sans imprimer)</li><li>debiter &nbsp;dans un premier temps&nbsp;</li><li>Si l'utilisateur n'imprime pas l'étiquette apres 8 j le compte &nbsp;recredité (cron)</li></ul></ul><li>logs (3 logs - log level permet de dire quel logfile sera généré)&nbsp;</li><ul><li>sortie standard : erreur lettre</li><li>.err : monitoré par l'IT : alerte SSI</li><li>.log : log maitrisé&nbsp;</li></ul><li>Inbound tracking ??</li><li>SAP??</li><li>parcel archive??</li></ul><li>SAP</li><ul><li>coté neoPost France</li><li>compte client , achat, annulation , toute communication financiere</li><li>Fonctionne par transactions (5 étapes)</li><li>Numero de transaction unique généré coté oss.&nbsp;</li><li>Scenario :&nbsp;</li><ul><li>Recharger &gt; Achat crédit lettre &gt; CB &gt; Acheter</li><ul><li>Transaction créée (status : commande en cours de création )</li></ul><li>Sherlock &gt; enter CB kinfo &gt; valider</li><ul><li>status : transmission sap en cours (ONGOING en bdd)</li><li>&gt; transaction envoyé a SAP avcec le code PACK (fournis par SAP) &nbsp;et information client. (siebel communique les infos de compte a sap a la creation des comptes user).</li><ul><li>param configurable dans la config .ini ou dynamique dans le code.&nbsp;</li><li>requete envoyé par le cron Send-Order - toutes les 5 minutes</li><li>Si Erreur technique &gt; CRON fail &gt; IT resolution manuelle</li><li>5 tentatives en cas d'erreur fonctionnelle (reponse webservice de type error)</li><li>Récapitulatif de paiement généré dans la page "mes achats"</li><li>LOG sap : data/temporary/logs/bapi.log</li><li><br></li></ul><li>If SAP order number recu d'SAP</li><ul><li>status -&gt; OK (bdd)</li></ul><li>else ERROR (bdd) - apres 5 tentatives (configurable)</li><ul><li>Pour les transactions en error un cron specifice remet le status en ONGOING pour qu'il soit rejouer par le cron send-order</li><li>en cas d'erreur pour chaque tentative un email est envoyé avec la requete envoyé et la reponse en piece jointe.&nbsp;</li></ul></ul></ul><li>Les PACKS :&nbsp;</li><ul><li>tous les items achetables corresponde a un pack</li><li>les code pack sont configuré et fourni par SAP.&nbsp;</li></ul><li>config shipping location</li><ul><li>Numero de client SAP&nbsp;</li><li>Numero de contact</li></ul><li>!!! chronoposte pas de compte de test</li><li>Nouvelle version</li><ul><li>(nouvelle version de SAP - sprint 47bis - en prod - avec paiement a l'acte)</li><li>Ancienne version&nbsp;</li><ul><li>1 requete par transaction (achat)</li><li>chaque shipment est lié à une transaction &nbsp;(apres coup , par un cron : sap-order - par purchase d'un shipment)</li><ul><li>on utilise toujours le dernier SAP order number disponible pour association avec le shipment&nbsp;</li></ul></ul><li>Paiement a l'acte</li><ul><li>une requete par shipment ( afin de transmettre les informaitons de prix) /!\</li><li>Nouvelle api&nbsp;</li><li>un code pack specifique pour les types shipment</li><ul><li>1 coded pack par taux&nbsp;</li><ul><li>!!! 0% pour les shipments internationnal</li><li>8,5%</li><li>20%</li></ul></ul><li>new : 2 orderlines :</li><ul><li>1 pour le shipment&nbsp;</li><li>1 pour la marge nid</li></ul><li>Donc plusieurs code pack pour la meme transaction ( impact db : BALA_PacksTransaction)</li><li>Possibliité de faire du multicolis en selectionnant plusieurs shipments dans le panier et faisant paiement a l'acte ( la balance doit etre vide pour avoir la propose)</li><ul><li>l'api n'accepte pas un numero de transaction identique dans plusieurs appels&nbsp;</li><li>&lt;Donc ajout d'un suffixe sur 4 digits (compromis) !!!</li><li>1 sap-order retourné par shipment par sap&nbsp;</li><ul><li>du coup creation d'une table association : BALA_TransactionsOrder pour associer 1 transaction a plusieurs sap-order</li></ul><li>champs sapOrder de la table balatransaction n'est plus utilisé.&nbsp;</li><ul><li>Script de migration de toan pour copier les données de ce champs vers la nouvelle table bala_transactionOrder</li></ul></ul></ul><li>Monthly billing (47bis)</li><ul><li>interet facilité paiement&nbsp;</li><li>until now 2 mode de paiement (par carte, par compte)</li><ul><li>cb :sherlock</li><li>compte neopost (siebel) - mise a jour par la requete sap</li></ul><li>doit etre acitivé</li><ul><li>upload de la demande d'adhesion&nbsp;</li><li>recup par neopost</li><li>Shiploc &gt; type de paiement &gt; &nbsp;autoriser paiement mensuel (Neopost FR)</li><li>A partir de la l'ecran mes achats change</li></ul><li>/!\ les transactions sont flagées avec le type de paiement (bala_type_transaction)&nbsp;</li><li>Cron qui envoie les donnes a sap au 4 du mois davpres</li><li>rappel:</li><li>Requete SAP :&nbsp;</li><ul><li>orderline tag (% taux de tva, )</li><ul><li>1 requete par taux&nbsp;</li><ul><li>sum des fee neopost</li><li>sum des carriage pice</li><li>neopost fee</li><li>overload</li><li>...</li></ul></ul></ul><li>Les achats de colis sont consideré comme du one shot</li></ul><li>Billing</li><li>overload</li></ul></ul></ul></div><p></p>


































  </div>
</body>
</html>
